<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.edu.xmu.restfuldemo.mapper.OrdersMapper">

    <select id="findOrders" parameterType="OrdersPo" resultType="OrdersPo">
        SELECT *
        FROM orders
        WHERE
        true
        <if test="id!=null">and id = #{id} </if>
    </select>

    <select id="findOrderItem" parameterType="OrderItemPo" resultType="OrderItemPo">
        SELECT *
        FROM order_item
        WHERE
        true
        <if test="orderId!=null">AND order_id = #{orderId} </if>
    </select>

    <insert id="createOrders" parameterType="OrdersPo" keyProperty="id" useGeneratedKeys="true">
        INSERT INTO orders(consignee,region_id,address,mobile,message,coupon_id,presale_id,groupon_id)
        VALUES(#{consignee},#{regionId},#{address},#{mobile}, #{message}, #{couponId},#{presaleId},#{grouponId})
    </insert>

    <insert id="createOrderItem" parameterType="OrderItemPo" keyProperty="id" useGeneratedKeys="true">
        INSERT INTO order_item(order_id,goods_sku_id,quantity,coupon_activity_id)
        VALUES(#{orderId},#{goodsSkuId},#{quantity},#{couponActivityId})
    </insert>

    <resultMap type="OrdersRetVo" id="OrdersOrderItemResultMap" autoMapping="true">
        <id property="id" column="id"/>
        <collection property="orderItems" ofType="cn.edu.xmu.restfuldemo.model.OrderItemRetVo" autoMapping="true">
            <result property="skuId" column="goods_sku_id"/>
            <result property="orderId" column="order_id"/>
            <result property="couponActId" column="coupon_activity_id"/>
            <result property="beSharedId" column="be_shared_id"/>
        </collection>
    </resultMap>

    <select id="findOrdersWithOrderItem" parameterType="OrdersPo" resultMap="OrdersOrderItemResultMap">
        SELECT *
        FROM orders o,order_item oi
        WHERE o.id = #{id} AND oi.order_id=#{id}
    </select>

</mapper>












